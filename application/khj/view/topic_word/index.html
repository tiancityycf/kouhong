{extend name='admin@public/content'}

{block name="button"}
{/block}

{block name="content"}
<div class="layui-form-item layui-inline">
    <div class="layui-form-item layui-inline">
        <a href="/static/excel/template_topic_word.xlsx">表格模板</a>
    </div>
    <div class="layui-form-item layui-inline">
        <button type="button" class="layui-btn layui-btn-sm layui-bg-blue" id="test1">
            <i class="layui-icon">&#xe67c;</i>批量导入
        </button>
    </div>
    <div class="layui-form-item layui-inline">
        <!--{if auth("$classuri/add")}-->
        <button data-modal='{:url("$classuri/add")}' data-title="添加" class='layui-btn layui-btn-sm layui-bg-green'>添加</button>
        <!--{/if}-->
    </div>
    <script>
    layui.use('upload', function(){
      var upload = layui.upload;
       
      //执行实例
      var uploadInst = upload.render({
        elem: '#test1' //绑定元素
        ,url: '/qmxz/topic_word/upload' //上传接口
        ,method: 'post'
        ,exts : 'xlsx'
        ,done: function(res){
            if(res.code == 1){
                layer.alert(res.msg, {title: '<i class="layui-icon">&#xe60b;</i>提示',}, function(index, item){
                    location.reload();
                });
            }else{
                layer.alert(res.msg);
            }
        }
        ,error: function(){
          //请求异常回调
        }
      });
    });
    </script>
</div>
<div class="layui-form-item layui-inline">
<form class="layui-form layui-form-pane form-search" action="{:request()->url()}" onsubmit="return false" method="get">
	<div class="layui-form-item layui-inline">
        <label class="layui-form-label">ID</label>
        <div class="layui-input-inline">
            <input name="id" value="{$Think.get.id|default=''}" placeholder="请输入想要搜索的关键字" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item layui-inline">
        <label class="layui-form-label">话题</label>
        <div class="layui-input-inline">
            <select name='topic_id' class='layui-select' lay-verify="required" lay-search="">
                <option value=''> - 所有话题 -</option>
                <!--{foreach $topic_list as $k => $v}-->
                <!--{if $Think.get.topic_id == $k}-->
                <option selected="selected" value='{$k}'> - {$v} - </option>
                <!--{else}-->
                <option value='{$k}'> - {$v} - </option>
                <!--{/if}-->
                <!--{/foreach}-->
            </select>
        </div>
    </div>
    <div class="layui-form-item layui-inline">
        <label class="layui-form-label">标题</label>
        <div class="layui-input-inline">
            <input name="title" value="{$Think.get.title|default=''}" placeholder="请输入想要搜索的关键字" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item layui-inline">
        <label class="layui-form-label">描述</label>
        <div class="layui-input-inline">
            <input name="des" value="{$Think.get.des|default=''}" placeholder="请输入想要搜索的关键字" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item layui-inline">
        <button class="layui-btn layui-btn-primary"><i class="layui-icon">&#xe615;</i> 搜 索</button>
    </div>
    <div class="layui-form-item layui-inline">
        <a onclick="loopAddBase(this)" class="layui-btn">循环加基数</a>
    </div>
</form>
</div>


<form onsubmit="return false;" data-auto="true" method="post">
	<!--{empty name='list'}-->
    <p class="help-block text-center well">没 有 记 录 哦！</p>
    <!--{else}-->
    <table class="layui-table" lay-skin="line">
    	<thead>
    	<tr>
            <th class='text-left nowrap'>操作</th>
            <th class='text-left nowrap'>ID</th>
            <th class='text-left nowrap'>所属话题</th>
            <th class='text-left nowrap'>小标签</th>
            <th class='text-left nowrap'>标题</th>
            <th class='text-left nowrap'>描述</th>
            <th class='text-left nowrap'>选项</th>
            <th class='text-left nowrap'>时间</th>
            
    	</tr>
    	</thead>
    	<tbody>
    	<!--{foreach $list as $key=>$vo}-->
    	<tr>
            <td class='text-left nowrap'>

                {if auth("$classuri/edit")}
                <span class="text-explode">|</span>
                <a data-title="编辑" data-modal='{:url("$classuri/edit")}?id={$vo.id}'>编辑</a>
                {/if}

                {if auth("$classuri/del")}
                <span class="text-explode">|</span>
                <a data-update="{$vo.id}" data-field='delete' data-action='{:url("$classuri/del")}'>删除</a>
                {/if}

            </td>
            <td class='text-left nowrap'>
                {$vo.id}
            </td>
            <td class='text-left nowrap'>
                <?php echo isset($topic_list[$vo['topic_id']]) ? $topic_list[$vo['topic_id']] : ''; ?>
            </td>
            <td class='text-left nowrap'>
                {$vo.small_label}
            </td>
            <td class='text-left nowrap'>
                {$vo.title}
            </td>
            <td class='text-left nowrap'>
                <?php if(mb_strlen($vo['des'], "utf-8") > 20) { echo mb_substr($vo['des'], 0, 20, "UTF8") . '...'; } else { echo $vo['des']; }?>
                {//$vo.des}
            </td>
            <td class='text-left nowrap'>
                {$vo['options']}
            </td>
            <td class='text-left nowrap'>
                {$vo.create_time|date='Y-m-d H:i:s'}
            </td>
            
    	</tr>
    	<!--{/foreach}-->
    	</tbody>
    </table>
    {if isset($page)}<p>{$page|raw}</p>{/if}
    <!--{/empty}-->
    <script>window.form.render();</script>
    <script>
        function loopAddBase(e){
            console.log('loopAddBase')
            $.ajax({
                url: '/qmxz/topic_word/loopAddBase',
                type: 'get',
                dataType: 'json',
                data: {},
                success: function(res){
                    if(res.status == 1){
                        layer.msg('success', {icon: 6});
                    }
                },
                error: function(){
                    console.log('fail');
                    layer.msg('fail', {icon: 5});
                }
            })
        }
    </script>
</form>
{/block}